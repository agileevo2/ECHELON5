<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>KOMMANDOPORTAL // ECHELON 5</title>
    <!-- S√∏rger for at den ser bra ut p√• mobil -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <style>
        /* --- GRUNNLEGGENDE STIL --- */
        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Consolas', 'Courier New', monospace; /* Agent/Terminal-font */
            background-color: #0a0a0a; /* Svart bakgrunn */
            color: #d4d4d4; /* Lys gr√• tekst */
            font-size: 15px;
            line-height: 1.6;
        }

        /* --- HOVEDLAYOUT --- */
        #portal {
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Fyller hele skjermen */
            max-width: 700px; /* God lesebredde */
            margin: 0 auto;
            border-left: 1px solid #333;
            border-right: 1px solid #333;
        }

        /* --- HEADER --- */
        #header {
            background-color: #1a1a1a;
            border-bottom: 2px solid #ff9900; /* Aksentfarge (oransje/amber) */
            padding: 12px 20px;
            text-align: center;
        }

        #header h1 {
            margin: 0;
            color: #ff9900;
            font-size: 1.1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* --- MELDINGSVISNING --- */
        #message-display {
            padding: 20px;
            flex-grow: 1; /* Tar opp all ledig plass */
            background-color: #111;
        }

        /* Meldingstitler (f.eks. CLASSIFIED MESSAGE) */
        #message-display h4 {
            color: #ff9900;
            border-bottom: 1px solid #444;
            padding-bottom: 8px;
            margin-top: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1.1rem;
        }

        /* Undertitler (f.eks. Reiseordre) */
        #message-display h5 {
            color: #b5b5b5;
            text-transform: uppercase;
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        #message-display p {
            margin-bottom: 15px;
        }

        /* Punktlister */
        #message-display ul {
            list-style-type: '‚Ä¢ ';
            margin-left: 20px;
            padding-left: 10px;
        }

        #message-display li {
            margin-bottom: 8px;
        }

        /* Uthevet tekst (f.eks. koordinater) */
        #message-display strong {
            color: #ffc266; /* Lysere oransje */
            font-weight: normal; /* Fonten er allerede "bold" */
        }
        
        /* Spesiell klasse for advarsler */
        .warning {
            color: #ff5555 !important; /* R√∏d for feilmeldinger */
        }
        
        /* Lenker til kart */
        .location-link {
            color: #ffc266;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 3px;
        }
        .location-link:hover {
            color: #ffd9a6;
        }
        
        /* Knapper (for nedlasting og GPS-verifisering) */
        .download-button, #verify-location-btn {
            display: block;
            background-color: #ff9900;
            color: #111;
            text-decoration: none;
            text-align: center;
            padding: 15px 20px;
            margin-top: 25px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 4px;
            cursor: pointer;
            border: none; /* For <button> elementet */
            font-family: 'Consolas', 'Courier New', monospace; /* Sikrer lik font */
            font-size: 1rem; /* Sikrer lik fontst√∏rrelse */
        }
        .download-button:hover, #verify-location-btn:hover {
            background-color: #ffc266;
        }
        
        #verify-location-btn:disabled {
            background-color: #555;
            color: #999;
            cursor: not-allowed;
        }


        /* Laste-animasjon */
        .loader {
            text-align: center;
            padding: 40px 20px;
            color: #ff9900;
            font-size: 1.1rem;
            animation: flicker 1.5s infinite alternate;
        }

        @keyframes flicker {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        /* --- INNTASTINGSOMR√ÖDE --- */
        /* Klistrer seg til bunnen av skjermen p√• mobil */
        #input-form {
            background-color: #1a1a1a;
            border-top: 2px solid #ff9900;
            padding: 15px;
            display: flex;
            position: sticky;
            bottom: 0;
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
        }

        #code-input {
            flex-grow: 1; /* Tar opp mesteparten av plassen */
            background: #222;
            border: 1px solid #444;
            color: #d4d4d4;
            padding: 14px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 1rem;
            border-radius: 4px 0 0 4px;
        }
        #code-input:focus {
            outline: none;
            border-color: #ff9900;
            background-color: #333;
        }

        #submit-btn {
            background-color: #ff9900;
            border: none;
            color: #111;
            padding: 14px 18px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 0 4px 4px 0;
            font-size: 1rem;
        }

        /* Omr√•de for feilmeldinger */
        #feedback {
            padding: 0 15px;
            text-align: center;
        }

    </style>
</head>
<body>

    <div id="portal">
        
        <!-- 1. HEADER -->
        <header id="header">
            <h1>ECHELON 5 // KOMMANDOPORTAL</h1>
        </header>

        <!-- 2. MELDINGSBOKS (Her vises alt innhold) -->
        <main id="message-display">
            <!-- Dette er den f√∏rste meldingen alle ser -->
            <h4>CLASSIFIED ACCESS POINT</h4>
            <p>Systemet krever celle-autentisering for tilgang.</p>
        </main>

        <!-- 3. TILBAKEMELDING (For "Adgang Nektet") -->
        <div id="feedback"></div>

        <!-- 4. INNTASTINGSFELT (Klistret til bunnen) -->
        <form id="input-form" onsubmit="submitCode(); return false;">
            <input type="text" id="code-input" placeholder="Skriv autorisasjonskode..." autocomplete="off">
            <button type="submit" id="submit-btn">DEKRYPTER</button>
        </form>

    </div>

    <script>
        // --- DATABASE MED KODEORD OG MELDINGER ---
        // Alle kodeord lagres som n√∏kler, og meldingene (HTML) som verdier.
        const briefings = {
            
            // --- FASE 1: OSLO ---
            'team oslo': `
                <h4>CLASSIFIED MESSAGE ‚Äî CELL O</h4>
                <h5>Clearance Level: ECHELON 4</h5>
                <p>Agent <strong>RAVEN</strong> og Agent <strong>FALCON</strong>, dere er n√• aktivert som Airborne Division. Etterretningen har registrert aktivitet i s√∏r.</p>
                <p><strong>Din rolle:</strong> Observasjon og identifikasjon.</p>
                
                <h5>Reiseordre:</h5>
                <ul>
                    <li>Transportmiddel: <strong>Tog</strong></li>
                    <li>Avreisedato: <strong>27. november</strong></li>
                    <li>Avgang: <strong>Oslo S kl. 09:25</strong></li>
                    <li>Destinasjon: <strong>Fortrolig</strong></li>
                </ul>
                <p>Ved ankomst skal dere ta dere til f√∏lgende observasjonspunkt:<br>
                <a href="https://www.google.com/maps/search/?api=1&query=58%C2%B008'40.6%22N+7%C2%B059'20.2%22E" target="_blank" class="location-link"><strong>58¬∞08'40.6"N 7¬∞59'20.2"E</strong></a></p>
                
                <h5>Oppdrag:</h5>
                <p>Overv√•k omr√•det fra avstand. Et kj√∏ret√∏y med registreringsnummer <strong>SD73382</strong> skal ankomme. F√∏reren har informasjon som er relevant for oppdragets videre fase.</p>
                <p><strong>Ikke gj√∏r kontakt</strong> f√∏r situasjonen er vurdert som trygg. N√•r observasjonen er fullf√∏rt, vent p√• nytt signal.</p>
                <p>Kodeord-del tildelt: <strong>AURORA</strong><br>(Behold dette ‚Äì brukes senere.)</p>
                <p>‚Äî Command Out.</p>
                <a href="#" class="download-button" onclick="downloadPakkliste()">Last ned Pakkliste (Echelon 3)</a>
            `,

            // --- FASE 1: STAVANGER ---
            'team stavanger': `
                <h4>CLASSIFIED MESSAGE ‚Äî CELL S</h4>
                <h5>Clearance Level: ECHELON 4</h5>
                <p>Agenter <strong>VIPER</strong>, <strong>COBRA</strong> og <strong>SHADOW</strong> ‚Äî dere er n√• aktivert som Ground Intelligence Unit. Etterretningen har registrert aktivitet i s√∏r.</p>
                <p><strong>Din rolle:</strong> Infiltrasjon og feltobservasjon.</p>

                <h5>Reiseordre:</h5>
                <ul>
                    <li>Transportmiddel: <strong>Bil</strong></li>
                    <li>Avreisedato: <strong>27. november</strong></li>
                    <li>Avgang: <strong>Stavanger kl. 11:30</strong></li>
                    <li>Destinasjon: <strong>Fortrolig</strong></li>
                </ul>
                <p>Ved ankomst skal dere posisjonere dere ved f√∏lgende koordinater:<br>
                <a href="https://www.google.com/maps/search/?api=1&query=58%C2%B008'40.6%22N+7%C2%B¬∞59'20.2%22E" target="_blank" class="location-link"><strong>58¬∞08'40.6"N 7¬∞59'20.2"E</strong></a></p>

                <h5>Oppdrag:</h5>
                <p>Etabler observasjonspunkt p√• parkeringsplassen. Dere vil bli kontaktet av en person som vet at dere kommer. Be om √• f√• kodeordet.</p>
                <p>V√¶r √•rv√•kne ‚Äî omr√•det kan v√¶re under overv√•king.</p>
                <p>Kodeord-del tildelt: <strong>BOREALIS</strong><br>(Behold dette ‚Äì brukes senere.)</p>
                <p>‚Äî Command Out.</p>
                <a href="#" class="download-button" onclick="downloadPakkliste()">Last ned Pakkliste (Echelon 3)</a>
            `,

            // --- FASE 2: SAMMENSL√ÖING ---
            'aurora borealis': `
                <h4>DIREKTIV K ‚Äî VERIFISERT</h4>
                <p>Sammensl√•ing av celler godkjent. Nytt direktiv:</p>
                <p>Dere skal ta ferjen som g√•r til Hirtshals <strong>16:30</strong>.</p>
                <p><a href="https://storage.googleapis.com/files_webpage/Privat/Colourline%20bilett.pdf" target="_blank" class="location-link"><strong>Referanse: Ferjebilletter</strong></a></p>
                <p>N√•r dere er ombord p√• b√•ten f√•r dere videre instruksjoner av Agent <strong>SHADOW</strong>.</p>
                <p>‚Äî Command Out.</p>
            `,

            // --- FASE 2: FERGE (KODE 1) ---
            'jylland': `
                <h4>CLASSIFIED TRANSMISSION ‚Äî SHIPBOARD DIRECTIVE</h4>
                <p>Godkjent tilgang.</p>
                <p>Under overfarten har systemet fanget opp et fragmentert signal med seks elementer. Hvert element representerer b√•de en bokstav og et tall, men bare en av delene er korrekt.</p>
                <p>Krypteringsmetoden f√∏lger <strong>NORSE‚Äì6-protokollen</strong> ‚Äì en kombinasjon av fonetisk og numerisk substitusjon.</p>

                <h5>Intercepted sequence:</h5>
                <p><strong>11-K, 15-O, 14-N, 22-V, 15-O, 25-Y</strong></p>

                <h5>For √• finne riktig bokstavkode m√• dere:</h5>
                <ol>
                    <li><strong>Avdekke m√∏nsteret:</strong><br>
                    Tallene refererer til alfabetets posisjoner (A = 1 ‚Ä¶ Z = 26). Men <strong>noen</strong> av tallene er falske; de skjuler seg bak primtall. Finn hvilke tall i sekvensen som er primtall, og bytt ut tilh√∏rende bokstaver med bokstaven som kommer <strong>f√∏r</strong> i alfabetet.</li>
                    
                    <li><strong>Bruk NATO-fonetisk filtrering:</strong><br>
                    Skriv hele den nye sekvensen i NATO-fonetisk form. Ta den <strong>tredje bokstaven</strong> i hvert fonetiske ord og skriv dem sammen.</li>
                    
                    <li><strong>Resultatet danner Transit Code Alpha (bokstavkode).</strong></li>
                </ol>
                <p>Skriv inn koden i portalen n√•r dere er enige.</p>
                <p>‚Äî Command Out.</p>
            `,

            // --- FASE 2: FERGE (KODE 2) ---
            // OPPDATERT MED GPS-KNAPP
            'lcvccn': `
                <h4>TRANSIT CODE ALPHA ‚Äî VERIFIED</h4>
                <p>Kryptert kommunikasjon gjenopprettet. Neste waypoint er aktivert.</p>
                
                <h5>Safehouse koordinater:</h5>
                <p><a href="https://www.google.com/maps/search/?api=1&query=57%C2%B003'48.6%22N+9%C2%B054'47.6%22E" target="_blank" class="location-link"><strong>57¬∞03'48.6"N 9¬∞54'47.6"E</strong></a></p>
                <p><strong>Lokasjon:</strong> N√∏rresundby</p>
                <p>G√• direkte til disse koordinatene. Hold lav profil. N√•r lokasjonen er sikret, m√• du verifisere din posisjon for √• motta neste direktiv.</p>
                
                <!-- NY KNAPP FOR GPS-SJEKK -->
                <button id="verify-location-btn" class="download-button" onclick="verifySafehouseLocation()">
                    VERIFISER POSISJON
                </button>
                
                <!-- Omr√•de for GPS-tilbakemelding -->
                <div id="location-feedback" style="margin-top: 15px; color: #ff9900; font-weight: bold;"></div>
            `,
            
            // --- FASE 3: SAFEHOUSE ---
            'safehouse check-in': `
                <h4>CLASSIFIED DIRECTIVE ‚Äî FLIGHT OPS</h4>
                <h5>Clearance Level: ECHELON 5</h5>
                <p>Godt jobbet, agenter. Lokasjon sikret.</p>
                <p>Etter den vellykkede overf√∏ringen fra fergen er situasjonen endret. V√•re analyser viser at GNM-modulen har v√¶rt aktiv i nettverkssporene vi overv√•ker.</p>
                <p>For √• sikre at minst ett lag kan rykke inn dersom situasjonen eskalerer, skal dere gjennomf√∏re akutt pilotoppl√¶ring i et kontrollert milj√∏.</p>
                
                <p><strong>Lokasjon:</strong> <a href="https://www.google.com/maps/search/?api=1&query=57%C2%B005'13.0%22N+9%C2%B052'18.1%22E" target="_blank" class="location-link"><strong>57¬∞05'13.0"N 9¬∞52'18.1"E</strong></a><br>
                    <strong>Tid:</strong> 10:00 i morgen</p>
                
                <p>Dere vil gjennomf√∏re et fullt <strong>pilottreningsprogram</strong> basert p√• F-16-plattformen. Forbered dere p√• h√∏yde, hastighet og presisjon.</p>
                <p>Etter fullf√∏rt √∏kt vil vertskapet gi dere neste autorisasjonskode.</p>
                <p>‚Äî Command Out.</p>
            `,

            // --- FASE 4: ETTER FLIGHT OPS ---
            'fuelcheck': `
                <h4>CLASSIFIED MESSAGE ‚Äî POST FLIGHT OPS DIRECTIVE</h4>
                <h5>Clearance Level: ECHELON 5</h5>
                <p>Flight-sekvens fullf√∏rt. Data bekrefter operativ beredskap hos alle enheter.</p>
                <p>Nye instruksjoner er sendt fra kommandoniv√•.</p>
                <p>Dere skal trekke tilbake til et sikkert sivilt kontaktpunkt for debrief og midlertidig avventing.</p>
                
                <h5>Lokasjon (Dekknavn):</h5>
                <p><a href="https://www.google.com/maps/search/?api=1&query=Slotsgade+33,+9000+Aalborg,+Denmark" target="_blank" class="location-link"><strong>ISIDOR HENIUS</strong></a><br>
                <span style="color: #888;">Slotsgade 33, 9000 Aalborg, Denmark</span></p>
                
                <p><strong>Oppdrag:</strong> M√∏t p√• stedet, ta kontakt med vertskapet. Der vil dere motta mat, drikke og videre ordre n√•r situasjonen tillater det.</p>
                <p>‚Äî Command Out.</p>
            `,

            // --- FASE 4: ETTER ISIDOR HENIUS ---
            'table 19': `
                <h4>CLASSIFIED MESSAGE ‚Äî EVENING DIRECTIVE</h4>
                <h5>Clearance Level: Echelon 5</h5>
                <p>Dataoverf√∏ring fra Contact Point Bravo er mottatt. Operasjonen g√•r inn i fase 6.</p>
                <p>Dere har gjort en solid innsats i felt, og kommando gir gr√∏nt lys for midlertid rekreasjon og sosial samling f√∏r videre operasjon.</p>
                <p>Returner til basen for klargj√∏ring.</p>
                
                <h5>Neste oppm√∏tested:</h5>
                <p>Et sivilisert deknavn brukt til lavprofil-m√∏ter mellom feltagenter:</p>
                <p><strong>Dekknavn:</strong> THE BLACK TABLE<br>
                <strong>Lokasjon:</strong> <a href="https://www.google.com/maps/search/?api=1&query=Restaurant+Flammen+Aalborg" target="_blank" class="location-link">Restaurant Flammen</a><br>
                <strong>Tid:</strong> 19:00</p>
                <p>‚Äî Command Out.</p>
            `,
            
            // --- FASE 5: P√Ö RESTAURANT FLAMMEN ---
            'specter one': `
                <h4>CLASSIFIED MESSAGE ‚Äî FIELD DIRECTIVE</h4>
                <h5>Clearance Level: Echelon 5</h5>
                <p>Bekreftelse mottatt fra Command.</p>
                <p>Satellittdata fra Jutland Sector viser aktivitet ved et tidligere treningsanlegg nordvest for Aalborg. Omr√•det g√•r under dekknavnet:</p>
                <p><strong>AMMO GROUND</strong></p>
                <p>Dere skal forflytte dere fra n√•v√¶rende base og v√¶re fullt operative ved morgengry.</p>
                
                <p><strong>Oppm√∏tested:</strong> <a href="https://www.google.com/maps/search/?api=1&query=Magasinvej+7,+9870+Sindal,+Denmark" target="_blank" class="location-link">Magasinvej 7, 9870 Sindal, Denmark</a><br>
                <strong>Tid:</strong> 09:00 i morgen</p>
                
                <h5>Instruks:</h5>
                <ul>
                    <li>Pakk alle personlige eiendeler og klargj√∏r utstyr for ny forflytning.</li>
                    <li>Etter fullf√∏rt oppdrag vil dere <strong>ikke returnere</strong> til n√•v√¶rende base.</li>
                    <li>V√¶r forberedt p√• overnatting annet sted etter feltoperasjonen.</li>
                </ul>
                
                <h5>Bekledning:</h5>
                <ul>
                    <li>Varmt og lagvis t√∏y (ull, fleece, vindtett jakke)</li>
                    <li>Gode sko eller vanntette st√∏vler</li>
                    <li>Hansker og hodeplagg (lue/buff)</li>
                    <li>Ingen sterke farger ‚Äî hold lav profil</li>
                </ul>
                <p>‚Äî Command Out.</p>
            `,

            // --- FASE 6: ETTER AMMO GROUND ---
            'nordstar': `
                <h4>CLASSIFIED MESSAGE ‚Äî EXTRACTION ORDER</h4>
                <h5>Clearance Level: ECHELON 5</h5>
                <p>Bekreftelse mottatt fra feltstyrken.</p>
                <p>Rapportene fra AMMO GROUND bekrefter at GNM-modulen er deaktivert. Interferensloggene viser at systemet fors√∏kte en reaktivering, men at signalet ble avbrutt.</p>
                <p>Operasjonen vurderes som suksessfull.</p>
                <p class="warning">Men deres posisjon er n√• kompromittert ‚Äî det antas at motparten vil fors√∏ke √• spore opp teamet.</p>
                
                <h5>Direktiv:</h5>
                <p>G√• i dekning umiddelbart. Dere skal forflytte dere til trygg sone for midlertidig evakuering.</p>
                <p><strong>Lokasjon:</strong> <a href="https://www.google.com/maps/search/?api=1&query=Skydebanevej+17,+9800+Hj√∏rring" target="_blank" class="location-link">Skydebanevej 17, 9800 Hj√∏rring</a><br>
                <strong>Dekknavn:</strong> Base Echo</p>
                <p>Hold lav profil under forflytning. Ved ankomst: sikre lokasjonen, l√•s alle d√∏rer, og avvent.</p>
                <p>‚Äî Command Out.</p>
            `,

            // --- FASE 7: P√Ö BASE ECHO (HJ√òRRING) ---
            'echofall': `
                <h4>CLASSIFIED MESSAGE ‚Äî DEBRIEF DIRECTIVE</h4>
                <h5>Clearance Level: ECHELON 5</h5>
                <p>Bekreftelse mottatt fra Base Echo.</p>
                <p>Operasjonen n√¶rmer seg konklusjon. Nye data fra kommandoniv√• viser at siste del av GNM-protokollen er fanget opp og isolert.</p>
                <p>Alle enheter skal n√• innkalles til endelig debrief og evaluering.</p>
                
                <p><strong>Dekknavn:</strong> Operation Bones<br>
                <strong>Tid:</strong> 20:00<br>
                <strong>Lokasjon:</strong> <a href="https://www.google.com/maps/search/?api=1&query=Bones+Restaurant,+Hj√∏rring" target="_blank" class="location-link">Bones Restaurant, Hj√∏rring</a></p>
                
                <p><strong>Oppdrag:</strong> M√∏t presist. Hold lav profil. Dette er siste steg f√∏r operasjonen avsluttes.</p>
                <p>‚Äî Command Out.</p>
            `,

            // --- FASE 8: AVSLUTNING (P√Ö BONES) ---
            'shadowfall': `
                <h4>CLASSIFIED MESSAGE ‚Äî OPERATION TERMINATION ORDER</h4>
                <h5>Clearance Level: ECHELON 5</h5>
                <p>Bekreftelse mottatt fra feltleder SHADOW. Alle enheter rapportert som sikre.</p>
                <p><strong>Operasjon NORTHERN STRIKE er herved erkl√¶rt fullf√∏rt.</strong></p>
                <p>GNM-protokollen er isolert, kryptert og fjernet fra aktivt nettverk. Dataene sikret ved AMMO GROUND og overf√∏rt via Base Echo har stanset reaktivering.</p>
                <p>Kommandosenteret beordrer umiddelbar tilbaketrekning og oppl√∏sning av operative enheter.</p>
                
                <h5>Direktiv:</h5>
                <ul>
                    <li>Alle enheter trekker ut av operasjonsomr√•det i morgen.</li>
                    <li>Avreise skjer via maritim transport.</li>
                    <li><strong>B√•tavgang:</strong> 12:15 (M√∏t ved terminal senest 11:45)</li>
                    <li><a href="https://storage.googleapis.com/files_webpage/Privat/Colourline%20bilett.pdf" target="_blank" class="location-link"><strong>Referanse: Ferjebilletter</strong></a></li>
                </ul>
                
                <h5>Transportplan:</h5>
                <ul>
                    <li><strong>Team Oslo:</strong> Forflytter seg videre med buss fra Kristiansand kl. 16:30.</li>
                    <li><strong>Team Stavanger:</strong> Returnerer kj√∏ret√∏yet til hjemmebase via landrute.</li>
                </ul>
                <p>Hold lav profil under transport. Unng√• identifiserbare symboler.</p>
                <p>Denne operasjonen vil ikke bli offentlig anerkjent. Deres innsats har v√¶rt avgj√∏rende.</p>
                <p><strong>Mission Complete.</strong></p>
                <p>‚Äî SHADOW / Command Out.</p>
            `,

            // --- NY TESTKOBLING (Varaberg) ---
            'varaberg': `
                <h4>GPS SYSTEM TEST // VARABERG</h4>
                <p>Dette er en test for √• sjekke om vi kan bruke GPS i webapp.</p>
                <p><strong>M√•l:</strong> Naviger til f√∏lgende koordinater:</p>
                <p><a href="https://www.google.com/maps/search/?api=1&query=58%C2%B052'57.8%22N+5%C2%B040'16.4%22E" target="_blank" class="location-link"><strong>58¬∞52'57.8"N 5¬∞40'16.4"E</strong></a></p>
                <p>Verifiser possisjon n√•r du er p√• stedet.</p>
                
                <button id="verify-varaberg-btn" class="download-button" onclick="verifyVarabergLocation()">
                    VERIFISER POSISJON (VARABERG)
                </button>
                
                <div id="location-feedback-varaberg" style="margin-top: 15px; color: #ff9900; font-weight: bold;"></div>
            `,
            
            'varaberg complete': `
                <h4>GPS TEST // VARABERG</h4>
                <h5>SYSTEM: POSISJON VERIFISERT</h5>
                <p>GPS-l√•s bekreftet. Avstand til m√•l er innenfor toleransegrensen.</p>
                <p>Denne testen er fullf√∏rt. Systemet fungerer som forventet.</p>
                <p>‚Äî Command Out.</p>
            `
        };

        // --- KJERNEFUNKSJONALITET ---
        
        // Henter elementene vi trenger
        const messageDisplay = document.getElementById('message-display');
        const codeInput = document.getElementById('code-input');
        const feedbackDisplay = document.getElementById('feedback');
        
        // Lagre den f√∏rste meldingen
        const initialMessage = messageDisplay.innerHTML;

        /**
         * Kj√∏res n√•r brukeren trykker "DEKRYPTER"
         */
        function submitCode() {
            // Hent og normaliser koden (sm√• bokstaver, ingen mellomrom)
            let code = codeInput.value.toLowerCase().trim();
            
            // Spesialtilfelle for "safehouse check-in"
            if (code === "safehouse check-in" || code === "safehouse checkin") {
                code = 'safehouse check-in';
            }
            
            // T√∏m feilmeldinger
            feedbackDisplay.innerHTML = '';

            // Pr√∏v √• finne koden i v√•r "database"
            const messageHtml = briefings[code];

            if (messageHtml) {
                // KODE FUNNET!
                
                // 1. Vis en "laste"-melding for effekt
                messageDisplay.innerHTML = `
                    <div class="loader">
                        DEKRYPTERER SIGNAL...<br>
                        VERIFISERER AUTORISASJON...<br>
                        ETABLERER SIKKER KOBLING...
                    </div>`;
                
                // 2. Vent 1.5 sekunder, og vis s√• den ekte meldingen
                setTimeout(() => {
                    messageDisplay.innerHTML = messageHtml;
                    window.scrollTo(0, 0); // Scroll til toppen
                    codeInput.value = ''; // T√∏m inputfeltet
                }, 1500);

            } else {
                // KODE IKKE FUNNET
                
                // Gi en feilmelding
                feedbackDisplay.innerHTML = '<p class="warning">ADGANG NEKTET. KODE IKKE GJENKJENT.</p>';
                
                // Rist p√• input-feltet for effekt (valgfritt)
                const form = document.getElementById('input-form');
                form.style.animation = 'shake 0.3s';
                setTimeout(() => { form.style.animation = ''; }, 300);
            }
        }
        
        /**
         * Genererer og laster ned pakklisten som en .txt-fil
         */
        function downloadPakkliste() {
            const pakklisteText = `PERSONLIG UTSTYR ‚Äî STANDARD LOADOUT
CLASSIFIED DOCUMENT ‚Äî EQUIPMENT MANIFEST

Clearance Level: ECHELON 3
Distribution: Authorized Field Units Only

---------------------------------
‚öôÔ∏è FELTUTSTYR
For oppdrag under skiftende v√¶r og lang forflytning:
---------------------------------
‚Ä¢ Ekstra ullsokker (ett par i vanntett pose)
‚Ä¢ Tynt sitteunderlag eller sammenrullbar pute (pause i felt)
‚Ä¢ √òrepropper (for s√∏vn eller st√∏y)
‚Ä¢ Powerbank
‚Ä¢ Ullundert√∏y
‚Ä¢ Fjellsko
‚Ä¢ Turbukse (helst uten flashy farger)
‚Ä¢ Jakke (helst uten flashy farger)
‚Ä¢ Tynne hansker
‚Ä¢ Lue

---------------------------------
üß≥ SIVILT / LOGISTIKK
For komfort og beredskap mellom operasjonene:
---------------------------------
‚Ä¢ Ekstra undert√∏y og sokker
‚Ä¢ Komfortabel bukse for innend√∏rs bruk
‚Ä¢ T-skjorte
‚Ä¢ Genser
‚Ä¢ Reisedokumenter, ID og kopi p√• mobilen
‚Ä¢ Liten notatbok og penn (for oppdragsnotater)

---------------------------------
üëî FORMELLT OPPDAGSANTREKK ‚Äî ‚ÄúCAUSAL BUSINESS‚Äù
---------------------------------
‚Ä¢ Finbukser
‚Ä¢ Skjorte
‚Ä¢ Jakke

---------------------------------
üß¥ DIVERSE / PERSONLIG
---------------------------------
‚Ä¢ Mobillader
‚Ä¢ Solbriller (lav sol i Danmark p√• vinteren)
‚Ä¢ Lommebok
‚Ä¢ Toalettsaker

---------------------------------
Instruks:
Pakk lett i ryggsekk. Du m√• regne med √• b√¶re tingene dine under forflytning.
Unng√• sterke farger og synlige logoer.
Hold lav profil.
‚Äî Command Logistics Division / Operation Northern Strike
`;
            
            // Lag en 'blob' (en fil i minnet)
            const blob = new Blob([pakklisteText], { type: 'text/plain;charset=utf-8' });
            
            // Lag en falsk nedlastingslenke
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'pakkliste.txt';
            
            // Klikk p√• lenken
            document.body.appendChild(link);
            link.click();
            
            // Rydd opp
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }

        // --- GPS VERIFISERINGSFUNKSJONER (NY KODE) ---

        // Definerer koordinatene for "Safehouse" fra 'lcvccn'-meldingen
        // 57¬∞03'48.6"N 9¬∞54'47.6"E
        const SAFEHOUSE_LAT = 57.0635;
        const SAFEHOUSE_LON = 9.913222;
        const MAX_DISTANCE_METERS = 150; // Agenten m√• v√¶re innenfor 150 meter

        /**
         * Kj√∏res n√•r agenten trykker "VERIFISER POSISJON"
         */
        function verifySafehouseLocation() {
            const feedback = document.getElementById('location-feedback');
            const btn = document.getElementById('verify-location-btn');
            
            if (!navigator.geolocation) {
                feedback.innerHTML = '<p class="warning">FEIL: GEOLOKASJON ST√òTTES IKKE AV DENNE ENHETEN.</p>';
                return;
            }

            feedback.innerHTML = 'S√∏ker etter GPS-signal... Godkjenn foresp√∏rsel i nettleser...';
            btn.disabled = true;
            btn.innerHTML = 'LOKALISERER...';

            const options = {
                enableHighAccuracy: true, // Ber om best mulig posisjon
                timeout: 10000,           // 10 sekunder timeout
                maximumAge: 0             // Tvinger frem en ny posisjonssjekk
            };

            // Start GPS-foresp√∏rselen
            navigator.geolocation.getCurrentPosition(locationSuccess, locationError, options);
        }

        /**
         * Kj√∏res HVIS vi f√•r en gyldig posisjon
         */
        function locationSuccess(pos) {
            const feedback = document.getElementById('location-feedback');
            const btn = document.getElementById('verify-location-btn');
            
            const userLat = pos.coords.latitude;
            const userLon = pos.coords.longitude;

            // Beregn avstanden fra agenten til m√•let
            const distance = calculateDistance(SAFEHOUSE_LAT, SAFEHOUSE_LON, userLat, userLon);

            if (distance <= MAX_DISTANCE_METERS) {
                // SUKSESS! Agenten er p√• rett sted.
                feedback.innerHTML = `POSISJON VERIFISERT (Avstand: ${Math.round(distance)}m). Laster neste direktiv...`;
                
                // Hent meldingen som h√∏rer til 'safehouse check-in'
                const messageHtml = briefings['safehouse check-in'];
                
                // Vis "laster" og deretter den nye meldingen (samme logikk som i submitCode)
                messageDisplay.innerHTML = `
                    <div class="loader">
                        POSISJON GODKJENT...<br>
                        DEKRYPTERER NESTE FASE...
                    </div>`;
                
                setTimeout(() => {
                    messageDisplay.innerHTML = messageHtml;
                    window.scrollTo(0, 0);
                }, 1500);

            } else {
                // FEIL: Agenten er for langt unna
                feedback.innerHTML = `<p class="warning">VERIFISERING NEKTET. POSISJON LOKALISERT, MEN DU ER IKKE VED M√ÖLET. (Avstand: ${Math.round(distance)}m). PR√òV IGJEN N√ÖR DU ER N√ÜRMERE.</p>`;
                btn.disabled = false;
                btn.innerHTML = 'VERIFISER POSISJON P√Ö NYTT';
            }
        }

        /**
         * Kj√∏res HVIS det oppst√•r en feil (f.eks. agenten nekter GPS-tilgang)
         */
        function locationError(err) {
            const feedback = document.getElementById('location-feedback');
            const btn = document.getElementById('verify-location-btn');
            
            let errorMsg = '';
            switch(err.code) {
                case err.PERMISSION_DENIED:
                    errorMsg = "ADGANG NEKTET. Systemet krever GPS-tilgang for √• verifisere posisjon.";
                    break;
                case err.POSITION_UNAVAILABLE:
                    errorMsg = "SIGNAL TAPT. Posisjonsdata er ikke tilgjengelig. Pr√∏v √• g√• utend√∏rs.";
                    break;
                case err.TIMEOUT:
                    errorMsg = "TIDSAVBRUDD. Kunne ikke hente posisjon. Sjekk GPS-signal og pr√∏v igjen.";
                    break;
                default:
                    errorMsg = "UKJENT GPS-FEIL. Kunne ikke verifisere posisjon.";
                    break;
            }
            feedback.innerHTML = `<p class="warning">${errorMsg}</p>`;
            btn.disabled = false;
            btn.innerHTML = 'VERIFISER POSISJON';
        }

        /**
         * Hjelpefunksjon for √• beregne avstand mellom to GPS-punkter (Haversine-formelen)
         * Returnerer avstanden i meter.
         */
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Jordens radius i meter
            const œÜ1 = lat1 * Math.PI / 180; // œÜ, Œª i radianer
            const œÜ2 = lat2 * Math.PI / 180;
            const ŒîœÜ = (lat2 - lat1) * Math.PI / 180;
            const ŒîŒª = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +
                      Math.cos(œÜ1) * Math.cos(œÜ2) *
                      Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            const d = R * c; // avstand i meter
            return d;
        }


        // --- NY GPS-FUNKSJON FOR VARABERG ---

        // Definerer koordinatene for "Varaberg"
        // 58¬∞52'57.8"N 5¬∞40'16.4"E
        const VARABERG_LAT = 58.882722;
        const VARABERG_LON = 5.671222;
        // MAX_DISTANCE_METERS er allerede definert (150) og gjenbrukes

        /**
         * Kj√∏res n√•r agenten trykker "VERIFISER POSISJON (VARABERG)"
         */
        function verifyVarabergLocation() {
            // M√• bruke unike ID-er for feedback og knapp
            const feedback = document.getElementById('location-feedback-varaberg'); 
            const btn = document.getElementById('verify-varaberg-btn');
            
            if (!navigator.geolocation) {
                feedback.innerHTML = '<p class="warning">FEIL: GEOLOKASJON ST√òTTES IKKE.</p>';
                return;
            }

            feedback.innerHTML = 'S√∏ker etter GPS-signal (VARABERG)...';
            btn.disabled = true;
            btn.innerHTML = 'LOKALISERER...';

            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            };

            // M√• lage nye suksess- og feil-handlers for √• unng√• konflikt
            navigator.geolocation.getCurrentPosition(varabergLocationSuccess, varabergLocationError, options);
        }

        /**
         * Kj√∏res HVIS vi f√•r en gyldig posisjon (Varaberg)
         */
        function varabergLocationSuccess(pos) {
            const feedback = document.getElementById('location-feedback-varaberg');
            const btn = document.getElementById('verify-varaberg-btn');
            
            const userLat = pos.coords.latitude;
            const userLon = pos.coords.longitude;

            // Beregn avstanden
            const distance = calculateDistance(VARABERG_LAT, VARABERG_LON, userLat, userLon);

            if (distance <= MAX_DISTANCE_METERS) {
                // SUKSESS!
                feedback.innerHTML = `POSISJON VERIFISERT (Avstand: ${Math.round(distance)}m). Laster...`;
                
                // Hent 'varaberg complete' meldingen
                const messageHtml = briefings['varaberg complete']; 
                
                messageDisplay.innerHTML = `<div class="loader">POSISJON GODKJENT...</div>`;
                
                setTimeout(() => {
                    messageDisplay.innerHTML = messageHtml;
                    window.scrollTo(0, 0);
                }, 1500);

            } else {
                // FEIL: For langt unna
                feedback.innerHTML = `<p class="warning">VERIFISERING NEKTET. (Avstand: ${Math.round(distance)}m). PR√òV IGJEN N√ÖR DU ER N√ÜRMERE.</p>`;
                btn.disabled = false;
                btn.innerHTML = 'VERIFISER POSISJON (VARABERG)';
            }
        }

        /**
         * Kj√∏res HVIS det oppst√•r en feil (Varaberg)
         */
        function varabergLocationError(err) {
            const feedback = document.getElementById('location-feedback-varaberg');
            const btn = document.getElementById('verify-varaberg-btn');
            
            let errorMsg = 'UKJENT GPS-FEIL.';
            if (err.code === err.PERMISSION_DENIED) {
                errorMsg = "ADGANG NEKTET. Systemet krever GPS-tilgang.";
            } else if (err.code === err.POSITION_UNAVAILABLE) {
                errorMsg = "SIGNAL TAPT. Posisjonsdata er ikke tilgjengelig.";
            } else if (err.code === err.TIMEOUT) {
                errorMsg = "TIDSAVBRUDD. Kunne ikke hente posisjon.";
            }
            
            feedback.innerHTML = `<p class="warning">${errorMsg}</p>`;
            btn.disabled = false;
            btn.innerHTML = 'VERIFISER POSISJON (VARABERG)';
        }

    </script>
    
    <!-- CSS for Riste-animasjon (valgfritt) -->
